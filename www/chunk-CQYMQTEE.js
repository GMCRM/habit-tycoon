import{$ as a,Aa as E,Ba as L,Ca as O,Da as V,E as c,Ea as N,Fa as F,G as g,Ga as U,Ha as W,I as x,K as f,Na as j,Pa as A,Q as m,Qa as z,R as o,S as n,Ta as B,U as y,V as M,Va as q,Wa as D,X as h,Xa as G,cb as H,da as _,ea as v,eb as J,fa as C,ib as K,kb as Q,na as b,oa as I,qb as X,ra as S,ta as T,u as w,ua as R,v as u,za as k}from"./chunk-ZSOHXC7X.js";import"./chunk-EQMUS7GP.js";import"./chunk-G4GOZ2R2.js";import"./chunk-QLV7WNCT.js";import"./chunk-33BWIX5B.js";import"./chunk-GSXUNAQW.js";import"./chunk-6F2JRA2A.js";import"./chunk-EGVB773T.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as P}from"./chunk-VI73JOY6.js";function Y(i,s){i&1&&(o(0,"div",17),a(1," Password must be at least 6 characters long "),n())}function Z(i,s){i&1&&(o(0,"div",17),a(1," Passwords do not match "),n())}function $(i,s){i&1&&(o(0,"span"),a(1,"Update Password"),n())}function ee(i,s){i&1&&(o(0,"span"),a(1,"Updating..."),n())}var me=(()=>{let s=class s{constructor(t,r,e,d){this.authService=t,this.router=r,this.route=e,this.toastController=d,this.newPassword="",this.confirmPassword="",this.isLoading=!1}ngOnInit(){this.route.fragment.subscribe(t=>{if(t){console.log("\u{1F504} URL fragment received:",t);let r=new URLSearchParams(t),e=r.get("access_token"),d=r.get("refresh_token");r.get("type")==="recovery"&&e&&d?console.log("\u2705 Valid password recovery session detected"):(console.warn("\u26A0\uFE0F Invalid or missing recovery parameters"),this.showErrorAndRedirect("Invalid or expired reset link"))}else console.warn("\u26A0\uFE0F No URL fragment found"),this.showErrorAndRedirect("Invalid reset link")})}onResetPassword(){return P(this,null,function*(){if(this.newPassword!==this.confirmPassword){yield(yield this.toastController.create({message:"Passwords do not match",duration:3e3,position:"top",color:"danger"})).present();return}if(this.newPassword.length<6){yield(yield this.toastController.create({message:"Password must be at least 6 characters long",duration:3e3,position:"top",color:"danger"})).present();return}this.isLoading=!0;try{let t=yield this.authService.updatePassword(this.newPassword);if(t.error){yield(yield this.toastController.create({message:"Failed to update password: "+t.error?.message||"Unknown error",duration:4e3,position:"top",color:"danger"})).present();return}yield(yield this.toastController.create({message:"\u2705 Password updated successfully! Please log in with your new password.",duration:5e3,position:"top",color:"success"})).present(),this.router.navigate(["/login"])}catch(t){console.error("Password update failed:",t),yield(yield this.toastController.create({message:"Failed to update password: "+t.message,duration:4e3,position:"top",color:"danger"})).present()}finally{this.isLoading=!1}})}showErrorAndRedirect(t){return P(this,null,function*(){yield(yield this.toastController.create({message:t,duration:4e3,position:"top",color:"danger"})).present(),setTimeout(()=>{this.router.navigate(["/login"])},2e3)})}};s.\u0275fac=function(r){return new(r||s)(g(X),g(T),g(S),g(K))},s.\u0275cmp=x({type:s,selectors:[["app-reset-password"]],decls:32,vars:8,consts:[["resetForm","ngForm"],["passwordInput","ngModel"],["confirmInput","ngModel"],[3,"translucent"],[1,"ion-padding"],[1,"center-card-container"],[1,"card-title"],[1,"instruction-text"],[3,"ngSubmit"],["position","floating"],["type","password","name","password","required","","minlength","6","maxlength","100",3,"ngModelChange","ngModel"],["class","error-message",4,"ngIf"],["type","password","name","confirmPassword","required","","maxlength","100",3,"ngModelChange","ngModel"],["expand","full","type","submit",3,"disabled"],[4,"ngIf"],[1,"login-link","ion-text-center","ion-margin-top"],["routerLink","/login"],[1,"error-message"]],template:function(r,e){if(r&1){let d=y();o(0,"ion-header",3)(1,"ion-toolbar")(2,"ion-title"),a(3,"Reset Password"),n()()(),o(4,"ion-content",4)(5,"div",5)(6,"ion-card")(7,"ion-card-content")(8,"h1",6),a(9,"Set New Password"),n(),o(10,"p",7),a(11,"Enter your new password below"),n(),o(12,"form",8,0),M("ngSubmit",function(){return w(d),u(e.onResetPassword())}),o(14,"ion-item")(15,"ion-label",9),a(16,"New Password"),n(),o(17,"ion-input",10,1),C("ngModelChange",function(l){return w(d),v(e.newPassword,l)||(e.newPassword=l),u(l)}),n()(),f(19,Y,2,0,"div",11),o(20,"ion-item")(21,"ion-label",9),a(22,"Confirm New Password"),n(),o(23,"ion-input",12,2),C("ngModelChange",function(l){return w(d),v(e.confirmPassword,l)||(e.confirmPassword=l),u(l)}),n()(),f(25,Z,2,0,"div",11),o(26,"ion-button",13),f(27,$,2,0,"span",14)(28,ee,2,0,"span",14),n()(),o(29,"div",15)(30,"a",16),a(31,"Back to Login"),n()()()()()()}if(r&2){let d=h(13),p=h(18),l=h(24);m("translucent",!0),c(17),_("ngModel",e.newPassword),c(2),m("ngIf",p.invalid&&p.touched),c(4),_("ngModel",e.confirmPassword),c(2),m("ngIf",l.touched&&e.newPassword!==e.confirmPassword),c(),m("disabled",!d.form.valid||e.newPassword!==e.confirmPassword||e.isLoading),c(),m("ngIf",!e.isLoading),c(),m("ngIf",e.isLoading)}},dependencies:[B,q,H,J,A,z,j,D,G,Q,I,b,W,V,k,E,N,F,U,O,L,R],styles:['.center-card-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:flex-start;min-height:100vh;padding:60px 20px 20px}ion-card[_ngcontent-%COMP%]{width:100%;max-width:400px;min-height:450px;border-radius:16px;box-shadow:0 4px 12px #00000026}.card-title[_ngcontent-%COMP%]{text-align:center;font-size:2rem;font-weight:700;color:var(--ion-color-primary);margin-bottom:8px}.instruction-text[_ngcontent-%COMP%]{text-align:center;color:var(--ion-color-medium-shade);font-size:.95rem;margin-bottom:24px}.divider[_ngcontent-%COMP%]{position:relative;margin:24px 0}.divider[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:0;right:0;height:1px;background:var(--ion-color-light-shade)}.divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{background:var(--ion-background-color);padding:0 16px;color:var(--ion-color-medium);font-size:.9rem}ion-item[_ngcontent-%COMP%]{--border-radius: 8px;--background: var(--ion-color-light);margin-bottom:16px}ion-button[_ngcontent-%COMP%]{margin-top:24px;height:48px;font-weight:600}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);font-size:.85rem;margin-top:-12px;margin-bottom:12px;padding-left:16px}.login-link[_ngcontent-%COMP%]{margin-top:24px}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--ion-color-primary);text-decoration:none;font-weight:500}.login-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}']});let i=s;return i})();export{me as ResetPasswordPage};
