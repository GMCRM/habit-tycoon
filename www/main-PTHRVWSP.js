import{H as h,Ha as S,J as m,K as g,M as d,N as u,O as f,P as C,Z as A,_ as v,aa as P,i as a,j as s,m as p,n as c,o as l,xa as w}from"./chunk-MCTHTYWV.js";import"./chunk-EQMUS7GP.js";import"./chunk-G4GOZ2R2.js";import"./chunk-QLV7WNCT.js";import"./chunk-33BWIX5B.js";import"./chunk-GSXUNAQW.js";import"./chunk-6F2JRA2A.js";import"./chunk-EGVB773T.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-2YSZFPCQ.js";import"./chunk-57YRIO75.js";import"./chunk-LRFGNCHE.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{j as r}from"./chunk-VI73JOY6.js";var y=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-M5MOPUJI.js").then(o=>o.HomePage)},{path:"login",loadComponent:()=>import("./chunk-GVSLFTGL.js").then(o=>o.LoginPage)},{path:"sign-up",loadComponent:()=>import("./chunk-FOUEVG63.js").then(o=>o.SignUpPage)},{path:"dev-tools",loadComponent:()=>import("./chunk-S3NDR7MI.js").then(o=>o.DevToolsPage)},{path:"create-habit-business",loadComponent:()=>import("./chunk-4FO4EGVN.js").then(o=>o.CreateHabitBusinessPage)},{path:"social",loadComponent:()=>import("./chunk-QM7SVT2F.js").then(o=>o.SocialPage)},{path:"stocks",loadComponent:()=>import("./chunk-JHWWRPSR.js").then(o=>o.StocksPage)},{path:"reset-password",loadComponent:()=>import("./chunk-C7SMJH36.js").then(o=>o.ResetPasswordPage)},{path:"settings",loadComponent:()=>import("./chunk-G56LCMDW.js").then(o=>o.SettingsPage)},{path:"**",redirectTo:"login",pathMatch:"full"}];var I=(()=>{let i=class i{constructor(t,e){this.authService=t,this.router=e}ngOnInit(){return r(this,null,function*(){console.log("\u{1F50D} AppComponent: Initializing app, current path:",window.location.pathname);try{let{data:{session:t}}=yield this.authService.getSession();if(t){console.log("\u2705 AppComponent: User session found");let e=window.location.pathname;e==="/login"||e==="/sign-up"||e==="/"?(console.log("\u{1F504} AppComponent: Redirecting from auth page to home"),this.router.navigate(["/home"])):console.log("\u{1F50D} AppComponent: Staying on current protected page:",e)}else{console.log("\u274C AppComponent: No user session found");let e=window.location.pathname;["/home","/social","/create-habit-business","/habit-checkin","/dev-tools"].includes(e)&&(console.log("\u{1F504} AppComponent: Redirecting from protected page to login"),this.router.navigate(["/login"]))}}catch(t){console.log("\u274C AppComponent: Session check failed:",t);let e=window.location.pathname;["/home","/social","/create-habit-business","/habit-checkin","/dev-tools"].includes(e)&&(console.log("\u{1F504} AppComponent: Redirecting from protected page to login (session check failed)"),this.router.navigate(["/login"]))}this.authService.onAuthStateChange((t,e)=>r(this,null,function*(){if(console.log("\u{1F50D} AppComponent: Auth state change:",t,"current path:",window.location.pathname),t==="SIGNED_OUT")console.log("\u{1F504} AppComponent: User signed out, redirecting to login"),this.router.navigate(["/login"]);else if(t==="SIGNED_IN"){console.log("\u{1F504} AppComponent: User signed in, ensuring profile exists...");try{yield this.authService.ensureUserProfileExists(e?.user),console.log("\u2705 AppComponent: User profile ensured")}catch(b){console.error("\u274C AppComponent: Failed to ensure user profile:",b)}let n=window.location.pathname;n==="/login"||n==="/sign-up"||n==="/"?(console.log("\u{1F504} AppComponent: User signed in from auth page, redirecting to home"),this.router.navigate(["/home"])):console.log("\u{1F50D} AppComponent: User signed in, staying on current page:",n)}}))})}};i.\u0275fac=function(e){return new(e||i)(a(S),a(g))},i.\u0275cmp=s({type:i,selectors:[["app-root"]],decls:2,vars:0,template:function(e,n){e&1&&(p(0,"ion-app"),l(1,"ion-router-outlet"),c())},dependencies:[P,v],encapsulation:2});let o=i;return o})();h(I,{providers:[{provide:m,useClass:A},w(),u(y,f(d),C())]});
